(e=>{"function"==typeof define&&define.amd?define("listingPlanEditor",e):e()})(function(){var a={template:`
		<div class="ts-icon-picker ts-icon-picker-vue">
			<div class="icon-preview" v-html="previewMarkup" @click.prevent="openLibrary" :title="modelValue"></div>

				<a href="#" @click.prevent="uploadSVG" class="ts-button ts-outline">Upload SVG</a>
				<a v-if="allowFonticons !== false" href="#" @click.prevent="openLibrary" class="ts-button ts-outline">Choose Icon</a>
				<a v-if="modelValue" href="#" @click.prevent="clear" class="ts-button ts-outline icon-only"><i class="lar la-trash-alt icon-sm"></i></a>

		</div>
	`,props:["modelValue","allowFonticons"],data(){return{previewMarkup:""}},created(){this.preview(this.modelValue)},methods:{preview(e){Voxel_Icon_Picker.getIconPreview(e,e=>this.previewMarkup=e)},openLibrary(){Voxel_Icon_Picker.edit(this.modelValue,e=>{this.setValue(e.library+":"+e.value)})},uploadSVG(){Voxel_Icon_Picker.getSVG(e=>{this.setValue("svg:"+e.id)})},clear(){this.setValue("")},setValue(e){this.preview(e),this.$emit("update:modelValue",e)}}};jQuery(e=>{var i=document.getElementById("vx-settings-paid-listings");if(i){let t=JSON.parse(i.dataset.config);i=Vue.createApp({el:i,data(){return{config:t,settings:t.settings,tab:"general",subtab:"general",loading:!1,editTemplate:{active:!1,updating:!1,modifyId:!1,newId:null},state:{}}},created(){var e=Voxel_Backend.getSearchParam("tab");e&&(e=e.split("."),this.setTab(e[0],e[1]))},methods:{setTab(e,t=""){this.tab=e,this.subtab=t;var i=new URL(window.location);i.searchParams.set("tab",t?e+"."+t:e),window.history.replaceState(null,null,i)},save(){this.loading=!0;var e=Voxel_Config.ajax_url+"&action=paid_listings.save_settings";jQuery.post(e,{settings:JSON.stringify(this.settings),_wpnonce:t._wpnonce},e=>{this.loading=!1,e.success?location.reload():Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},createPricingTemplate(){jQuery.get(Voxel_Config.ajax_url,{action:"paid_listings.create_pricing_template",_wpnonce:t._wpnonce}).always(e=>{e.success?this.settings.templates.pricing=e.template_id:Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},deletePricingTemplate(){confirm(Voxel_Config.l10n.confirmAction)&&jQuery.get(Voxel_Config.ajax_url,{action:"paid_listings.delete_pricing_template",_wpnonce:t._wpnonce}).always(e=>{e.success?this.settings.templates.pricing=null:Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},updatePricingTemplate(){this.editTemplate.updating=!0,jQuery.get(Voxel_Config.ajax_url,{action:"paid_listings.update_pricing_template",template_id:this.editTemplate.newId,_wpnonce:t._wpnonce}).always(e=>{this.editTemplate.updating=!1,e.success?(this.editTemplate.modifyId=!1,this.settings.templates.pricing=e.template_id):Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},currencyFormat(){return Voxel_Backend.helpers.currencyFormat(...arguments)}},computed:{$w(){return window}}});i.component("draggable",vuedraggable),i.component("icon-picker",a),i.component("color-picker",Voxel_Backend.components.Color_Picker),i.mount("#vx-settings-paid-listings")}}),jQuery(e=>{var t=document.getElementById("vx-edit-listing-plan");if(t){let e=JSON.parse(t.dataset.config);t=Vue.createApp({el:t,data(){return{config:e,plan:e.plan,tab:"general",subtab:"general",loading:!1,activeLimit:null,newLimit:{total:null,post_types:[],mark_verified:!1,priority:{enabled:!1,value:1},expiration:{mode:"auto",fixed_days:null}}}},created(){window.Plan_Editor=this;var e=Voxel_Backend.getSearchParam("tab");e&&(e=e.split("."),this.setTab(e[0],e[1]))},methods:{setTab(e,t=""){this.tab=e,this.subtab=t;var i=new URL(window.location);i.searchParams.set("tab",t?e+"."+t:e),window.history.replaceState(null,null,i)},save(){this.loading=!0;var e=Voxel_Config.ajax_url+"&action=paid_listings.update_listing_plan";jQuery.post(e,{plan:JSON.stringify(this.plan)},e=>{this.loading=!1,e.success?location.reload():alert("Error:\n - "+e.errors.join("\n - "))})},deletePlan(){var e;confirm("This will permanently delete this plan. Do you want to continue?")&&(this.loading=!0,e=Voxel_Config.ajax_url+"&action=paid_listings.delete_listing_plan",jQuery.post(e,{plan:this.plan},e=>{this.loading=!1,e.success?location.href=e.redirect_to:alert("Error:\n - "+e.errors.join("\n - "))}))},currencyFormat(e,t){return Voxel_Backend.helpers.currencyFormat(e,t)},addLimit(){var e=structuredClone(Vue.toRaw(this.newLimit));this.plan.limits.push(e)},canAddLimit(){return Object.values(this.config.post_types).some(e=>this.isPostTypeAvailable(e,null))},getLimitTitle(e){return e.post_types.length?e.post_types.map(e=>this.config.post_types[e].label).join(", "):"(no post types selected)"},isPostTypeAvailable(e,t){for(var i of this.plan.limits)if(i!==t&&i.post_types.includes(e.key))return!1;return!0}},computed:{$w(){return window}}});t.component("field-key",Voxel_Backend.components.Field_Key),t.component("draggable",vuedraggable),t.mount("#vx-edit-listing-plan")}})});
