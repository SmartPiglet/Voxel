(e=>{"function"==typeof define&&define.amd?define("elementor",e):e()})(function(){elementor.modules.controls.Voxel_Post_Select=elementor.modules.controls.BaseData.extend({onReady(){let t=this.model.attributes.post_type,l=this.$el.find("input");var e=this.$el.find(".clear-value");let i=this.$el.find(".search-results"),o=this.$el.find(".value-wrap"),n=this.$el.find(".current-value"),s=n.attr("href");var a,r=this.getControlValue();r&&(a=VX_Post_Select_Cache[r]?`<span>: ${VX_Post_Select_Cache[r]}</span>`:"",n.html(`<b>#${r}</b>`+a),n.attr("href",s.replace(":id",r)),o.show()),l.on("input",Voxel_Backend.helpers.debounce(e=>{e=e.currentTarget.value.trim();e.length?(i.addClass("vx-disabled"),jQuery.get(Voxel_Config.ajax_url,{action:"general.search_posts",search:e,post_types:t.join(",")}).always(e=>{if(i.removeClass("vx-disabled hide"),e.success&&e.results.length){let t=[];e.results.forEach(e=>{t.push(`
						<div class="search-result">
							<a href="#" data-id="${e.id}">
								<b>#${e.id}: </b>
								<span>${e.title}</span>
							</a>
						</div>`)}),i.html(t.join(""))}else i.html("<p>No results found.</p>")})):i.addClass("hide")})),i.on("click","a",e=>{e.preventDefault();var t=e.currentTarget.dataset.id,e=e.currentTarget.querySelector("span").innerText;this.setValue(t),this.applySavedValue(),n.html(`<b>#${t}</b><span>: ${e}</span>`),n.attr("href",s.replace(":id",t)),o.show(),l.val(""),i.addClass("hide"),VX_Post_Select_Cache[t]=e}),e.on("click",e=>{e.preventDefault(),console.log(o),this.setValue(""),this.applySavedValue(),o.hide()})}}),elementor.modules.controls.Voxel_Term_Select=elementor.modules.controls.BaseData.extend({onReady(){let t=this.model.attributes.taxonomy,l=this.$el.find("input");var e=this.$el.find(".clear-value");let i=this.$el.find(".search-results"),o=this.$el.find(".value-wrap"),n=this.$el.find(".current-value"),s=n.attr("href");var a,r=this.getControlValue();r&&(a=VX_Term_Select_Cache[r]?`<span>: ${VX_Term_Select_Cache[r]}</span>`:"",n.html(`<b>#${r}</b>`+a),n.attr("href",s.replace(":id",r)),o.show()),l.on("input",Voxel_Backend.helpers.debounce(e=>{e=e.currentTarget.value.trim();e.length?(i.addClass("vx-disabled"),jQuery.get(Voxel_Config.ajax_url,{action:"general.search_terms",search:e,taxonomy:t.join(",")}).always(e=>{if(i.removeClass("vx-disabled hide"),e.success&&e.results.length){let t=[];e.results.forEach(e=>{t.push(`
						<div class="search-result">
							<a href="#" data-id="${e.id}">
								<b>#${e.id}: </b>
								<span>${e.title}</span>
							</a>
						</div>`)}),i.html(t.join(""))}else i.html("<p>No results found.</p>")})):i.addClass("hide")})),i.on("click","a",e=>{e.preventDefault();var t=e.currentTarget.dataset.id,e=e.currentTarget.querySelector("span").innerText;this.setValue(t),this.applySavedValue(),n.html(`<b>#${t}</b><span>: ${e}</span>`),n.attr("href",s.replace(":id",t)),o.show(),l.val(""),i.addClass("hide"),VX_Term_Select_Cache[t]=e}),e.on("click",e=>{e.preventDefault(),console.log(o),this.setValue(""),this.applySavedValue(),o.hide()})}}),elementor.addControlView("voxel-relation",elementor.modules.controls.BaseData.extend({onReady(){var n=this.model.get("vx_target"),s=this.model.get("vx_group"),a="right"===this.model.get("vx_side")?"right":"left",r="right"==a?"left":"right",e=elementor.$previewContents.find(".elementor-widget."+n),d=this.$el.find(".vx-relation-list"),t=n.replace("elementor-widget-",""),c=Vue.capitalize(Vue.camelize(t.replace("ts-",""))),h=this.options.container.id;elementor.config.voxel.relations[s]||(elementor.config.voxel.relations[s]=[]),e.each((e,t)=>{var l,i,o;t.parentElement.closest("."+n)||(l=t.dataset.id,i=!!elementor.config.voxel.relations[s].find(e=>e[a]===h&&e[r]===l),(o=jQuery(`
				<div class="relation-item ${i?"selected":""}">
					<span>&lt;${c} <code>#${l}</code>&gt;</span>
					<i class="las la-check check-icon"></i>
					<i class="las la-eye view-icon"></i>
				</div>
			`)).on("mouseenter",()=>t.classList.add("voxel-highlight-element")),o.on("mouseleave",()=>t.classList.remove("voxel-highlight-element")),o.on("click",".view-icon",e=>{e.stopPropagation(),Voxel_Backend.helpers.isAnyPartOfElementInViewport(t)||t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}),o.on("click",()=>{o.toggleClass("selected").siblings().removeClass("selected"),this.setValue(null),elementor.config.voxel.relations[s]=elementor.config.voxel.relations[s].filter(e=>e[a]!==h),o.hasClass("selected")&&(elementor.config.voxel.relations[s]=elementor.config.voxel.relations[s].filter(e=>e[r]!==l),elementor.config.voxel.relations[s].push({left:"left"==a?h:l,right:"left"==a?l:h})),d.addClass("vx-disabled"),jQuery.post(Voxel_Config.ajax_url,{action:"elementor.save_temporary_config",document_id:elementor.config.document.id,voxel:JSON.stringify(window.voxel_prepare_page_settings())}).always(e=>{d.removeClass("vx-disabled")})}),d.append(o))}),d.find(".relation-item").length||d.html(`<div class="relation-item">No &lt;${c}&gt; widgets found.</div>`)}})),elementor.addControlView("voxel-visibility",elementor.modules.controls.BaseData.extend({onReady(){this._updatePreview(),this.$el.find(".vx-rules-edit").on("click",()=>{Voxel_Dynamic.editVisibility(this.getControlValue(),{groups:Voxel_Elementor_Config.editing_groups,onSave:e=>{this.setValue(e.length?e:""),this.applySavedValue(),this._updatePreview(),_vx_refresh_nav_rules(this.options.container.model)}})}),this.$el.find(".vx-rules-remove").on("click",()=>{this.setValue(""),this.applySavedValue(),this._updatePreview(),_vx_refresh_nav_rules(this.options.container.model)})},_updatePreview(){var e=this.getControlValue();this.$el.find(".vx-visibility-rules").html(Voxel_Dynamic.formatRulesAsHTML(e))}})),elementor.addControlView("voxel-loop",elementor.modules.controls.BaseData.extend({onReady(){this._updatePreview(),this.$el.find(".vx-loop-edit").on("click",()=>{Voxel_Dynamic.editLoop({currentValue:this.getControlValue(),groups:Voxel_Elementor_Config.editing_groups,onSave:e=>{this.setValue("string"==typeof e?e:""),this.applySavedValue(),this._updatePreview(),_vx_refresh_nav_loops(this.options.container.model)}})}),this.$el.find(".vx-loop-remove").on("click",()=>{this.setValue(""),this.applySavedValue(),this._updatePreview(),_vx_refresh_nav_loops(this.options.container.model)}),this.$el.find(".vx-current-loop").on("dblclick","span",e=>{this.$el.find(".vx-current-loop-value").toggleClass("hide").focus()})},_updatePreview(){let e='<span class="elementor-control-field-description">No loop</span>';var t=this.getControlValue();"string"==typeof t&&t.length&&(e=`<span class="vx-loop-path">${t}</span>`),this.$el.find(".vx-current-loop").html(e),this.$el.find(".vx-current-loop").append('<input type="text" class="vx-current-loop-value hide" placeholder="Enter loop tag manually">'),this.$el.find(".vx-current-loop-value").val(t),this.$el.find(".vx-current-loop-value").on("keypress",e=>{"Enter"===e.key&&(this.setValue(e.target.value.trim()),this.applySavedValue(),this._updatePreview(),_vx_refresh_nav_loops(this.options.container.model))})}})),elementor.modules.controls.RepeaterRow.prototype.setTitle=function(){var e=this.getOption("titleField"),t="";"string"==typeof(t=(t=e?Marionette.TemplateCache.prototype.compileTemplate(e)(this.model.parseDynamicSettings()):t)||sprintf("Item #%s",this.getOption("itemIndex")))&&(t=t.replace("@tags()","").replace("@endtags()","")),this.ui.itemTitle.html(t)};var i={text:"BaseData",textarea:"BaseData",number:"Number",wysiwyg:"Wysiwyg",date_time:"Date_time",url:"Url",media:"Media",gallery:"Gallery",icons:"Icons",code:"Code","voxel-post-select":"Voxel_Post_Select","voxel-term-select":"Voxel_Term_Select"};Object.keys(i).forEach(e=>{var t,l=elementor.modules.controls[i[e]];l?(t={onReady:l.prototype.onReady||(()=>{}),onBeforeDestroy:l.prototype.onBeforeDestroy||(()=>{})},elementor.addControlView(e,l.extend({onReady(){t.onReady.call(this),this.$el.prepend('<a href="#" class="enable-tags"><span>Enable Voxel tags</span></a>'),this.$el.find(".elementor-control-input-wrapper").first().before(`
				<div class="edit-voxel-tags" style="display: none;">
					<div class="tags-content"></div>
					<div class="dbuttons">
						<a href="#" class="edit-tags">Edit tags</a>
						<a href="#" class="disable-tags">Disable tags</a>
					</div>
				</div>
			`),Voxel_Dynamic.isDynamicString(this._getDynamicValue())&&this._enableTags(),this.$el.on("click",".enable-tags",()=>{this._enableTags(),this._editTags()}),this.$el.on("click",".edit-tags",this._editTags.bind(this)),this.$el.on("click",".disable-tags",this._disableTags.bind(this))},onBeforeDestroy(){t.onBeforeDestroy.call(this),this.$el.off("click",".enable-tags",this._enableTags.bind(this)),this.$el.off("click",".edit-tags",this._editTags.bind(this)),this.$el.off("click",".disable-tags",this._disableTags.bind(this))},_getDynamicValue(){return this.getControlValue()},_setDynamicValue(e){this.setValue(e)},_editTags(){Voxel_Dynamic.edit(Voxel_Dynamic.getDynamicString(this._getDynamicValue()),{groups:Voxel_Elementor_Config.editing_groups,onSave:e=>{this._setDynamicValue(`@tags()${e}@endtags()`),this.applySavedValue(),this.$el.find(".edit-voxel-tags .tags-content").html(Voxel_Dynamic.formatAsHTML(e)),this.options?.container?.model?.renderRemoteServer?.()}})},_enableTags(){var e=Voxel_Dynamic.getDynamicString(this._getDynamicValue());this._setDynamicValue(`@tags()${e}@endtags()`),this.applySavedValue(),this.$el.addClass("voxel-tags-active"),this.$el.find(".enable-tags").hide(),this.$el.find(".edit-voxel-tags .tags-content").html(Voxel_Dynamic.formatAsHTML(e)),this.$el.find(".edit-voxel-tags").show()},_disableTags(){confirm("Are you sure?")&&(this.$el.removeClass("voxel-tags-active"),this.$el.find(".enable-tags").show(),this.$el.find(".edit-voxel-tags").hide(),this._setDynamicValue(""),this.applySavedValue())}}))):console.warn(`Control module for "${e}" does not exist.`)}),elementor.modules.controls.Color.prototype.applySavedValue=function(){var e,t=this.getCurrentValue();this.colorPicker?t?(e=this.colorPicker.picker._parseLocalColor(t),this.colorPicker.picker.setHSVA(...e.values||[],!1)):this.colorPicker.picker._clearColor(!0):this.initPicker(),this.$el.toggleClass("e-control-color--no-value",!t)},elementor.modules.controls.Url.prototype._getDynamicValue=function(){return this.getControlValue().url},elementor.modules.controls.Url.prototype._setDynamicValue=function(e){return this.setValue("url",e)},elementor.modules.controls.Media.prototype._getDynamicValue=function(){return this.getControlValue().id},elementor.modules.controls.Media.prototype._setDynamicValue=function(e){return this.setValue("url",e),this.setValue("id",e)},elementor.modules.controls.Gallery.prototype._getDynamicValue=function(){return this.getControlValue()[0]?.id||[]},elementor.modules.controls.Gallery.prototype._setDynamicValue=function(e){return this.setValue([{id:e,url:" "}])},elementor.modules.controls.Icons.prototype._getDynamicValue=function(){return this.getControlValue().value},elementor.modules.controls.Icons.prototype._setDynamicValue=function(e){return this.setValue({value:e,library:" "})},elementor.modules.controls.Icons.prototype.applySavedValue=function(){var e=this.getControlValue(),t=this.model.get("skin"),l="inline"===t?this.ui.inlineDisplayedIcon:this.ui.previewPlaceholder,i=this.model.get("disable_initial_active_state"),o=this.model.get("default");let n=e.value,s=e.library;return this.isMigrationAllowed()||n||!this.getValueToMigrate()||(n=this.getControlValue(),s=""),"media"===t&&this.ui.controlMedia.toggleClass("elementor-media-empty",!n),("inline"===t&&!i||s)&&this.markChecked(s),n?"svg"===s&&"inline"!==t?elementor.helpers.fetchInlineSvg(n.url,e=>{new RegExp("<html|<head|<body","im").test(e)||this.ui.previewPlaceholder.html(e)}):("media"!==t&&"svg"===s||(e='<i class="'+n+'"></i>',l.html(e)),void this.enqueueIconFonts(s)):"inline"===t?void this.setDefaultIconLibraryLabel(o,l):void this.ui.previewPlaceholder.html("")},elementor.modules.controls.Select2.prototype.handleLockedOptions=function(){let t=this.model.get("lockedOptions");t&&this.ui.select.on("select2:unselecting",e=>{t.includes(e.params.args.data.id)&&e.preventDefault()});var l=this.ui.select,i=l.next(".select2-container").first("ul.select2-selection__rendered");i.on("click touchstart",e=>{jQuery(e.target).hasClass("select2-selection__choice__remove")&&e.stopImmediatePropagation()}),i.sortable({placeholder:"ui-state-highlight",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",containment:"parent"}),i.on("sortupdate",e=>{e.stopImmediatePropagation(),jQuery(i.find(".select2-selection__choice").get().reverse()).each((e,t)=>{var t=jQuery(t).find("._s2-value").data("value");t&&(t=l.find('option[value="'+t+'"]')[0],l.prepend(t))}),this.ui.select.trigger("change")}),i.on("sortstop",e=>e.stopImmediatePropagation())},elementor.modules.controls.Select2.prototype.getSelect2Options=function(){return jQuery.extend(this.getSelect2DefaultOptions(),this.model.get("select2options"),{templateSelection:e=>jQuery('<span class="_s2-value"></span>').data("value",e.id).text(e.text)})},elementor.modules.controls.Wysiwyg.prototype.applySavedValue=function(){var e=this.getControlValue();this.editor&&!Voxel_Dynamic.isDynamicString(e)&&(this.editor.setContent(e),jQuery("#"+this.editorID).val(e))},elementor.modules.controls.Wysiwyg.prototype.saveEditor=function(){this.$el.hasClass("voxel-tags-active")||this.setValue(this.editor.getContent())};let o=null;function e(e,l){let t=e.findIndex(e=>"clipboard"===e.name);return-1===t?t=e.length?e.length-1:0:t+=1,e.splice(t,0,{name:"conditions_group",actions:[{name:"vx_group",title:"Voxel",isEnabled:()=>!1},{name:"vx_group",title:"Copy visibility rules",isEnabled:()=>{var e=l.model.getSetting("_voxel_visibility_rules");return Array.isArray(e)&&e.length},callback:function(){var e=l.model.getSetting("_voxel_visibility_rules"),t="hide"===l.model.getSetting("_voxel_visibility_behavior")?"hide":"show";o=JSON.parse(JSON.stringify({conditions:e,behavior:t})),sessionStorage.setItem("vx_copy_visibility_rules",JSON.stringify(o))}},{name:"paste_conditions",title:"Paste visibility rules",isEnabled:()=>"object"==typeof o&&null!==o&&Array.isArray(o.conditions)&&o.conditions.length,callback:function(){l.model.setSetting("_voxel_visibility_behavior","hide"===o.behavior?"hide":"show"),l.model.setSetting("_voxel_visibility_rules",JSON.parse(JSON.stringify(o.conditions))),_vx_refresh_nav_rules(l.model)}}]}),e}var t=sessionStorage.getItem("vx_copy_visibility_rules");t&&(o=JSON.parse(t));elementor.hooks.addFilter("elements/widget/contextMenuGroups",e),elementor.hooks.addFilter("elements/container/contextMenuGroups",e),window.voxel_handle_tags=l=>(Object.keys(l).forEach(e=>{var t;"string"==typeof l[e]&&Voxel_Dynamic.isDynamicString(l[e])&&(40<(t=Voxel_Dynamic.getDynamicString(l[e])).length&&(t=t.substring(0,40)+"..."),l[e]=`<span class="dtags-elementor" dtags>${Voxel_Dynamic.formatForEditorPreview(t)}</span>`)}),l),window.voxel_prepare_page_settings=()=>{function i(e){var t=[];for(t.push(e.parent().find("> .elementor-element").index(e));;){if(!(e=e.parent().closest("[data-id], [data-elementor-type]")).length||e.get(0).matches("[data-elementor-type]"))break;t.push(e.parent().find("> .elementor-element:not(.elementor-sticky__spacer)").index(e))}return t.reverse().join(".")}let t=elementor.config.voxel.relations,l=(Object.keys(t).forEach(e=>{t[e].filter(e=>{var t=elementor.$previewContents.find(".elementor-element-"+e.left),l=elementor.$previewContents.find(".elementor-element-"+e.right);return!(!t.length||!l.length||(e.leftPath=i(t),e.rightPath=i(l),0))})}),{});return elementor.$previewContents.find(".elementor-widget-ts-template-tabs").each((e,t)=>{l[t.dataset.id]=i(jQuery(t))}),{relations:t,template_tabs:l}},window.voxel_reload_preview=()=>{elementorCommon.dialogsManager.createWidget("confirm",{headerMessage:"Apply Changes",message:"This will update the document with the current changes and reload the preview.",strings:{confirm:"Apply & Reload preview"},onConfirm:function(){$e.run("document/save/update").then(()=>{jQuery("#elementor-preview-loading").show(),setTimeout(()=>{$e.internal("editor/documents/attach-preview",{shouldScroll:!1}).then(()=>jQuery("#elementor-loading, #elementor-preview-loading").fadeOut(600))},15)})}}).show()},window.voxel_reload_editor=()=>{elementorCommon.dialogsManager.createWidget("confirm",{headerMessage:"Apply Changes",message:"This will update the document with the current changes and reload the page.",strings:{confirm:"Apply & Reload page"},onConfirm:function(){$e.run("document/save/update").then(()=>location.reload())}}).show()},elementor.hooks.addFilter("elements/widget/behaviors",e=>(e.InlineEditing.behaviorClass.prototype.onInlineEditingClick=function(e){let t=jQuery(e.currentTarget);this.view.getEditModel().getSetting(t.data().elementorSettingKey)?.includes("@tags()")||setTimeout(()=>this.startEditing(t),30)},e)),$e.components.get("document/save").on("save",e=>{function i(e){let l=[];return l.push(e.parent().find("> .elementor-element").index(e)),e.parents("[data-id]").each((e,t)=>{l.push(jQuery(t).parent().find("> .elementor-element").index(t))}),l.reverse().join(".")}let t=elementor.config.voxel.relations,l=(Object.keys(t).forEach(e=>{t[e].filter(e=>{var t=elementor.$previewContents.find(".elementor-element-"+e.left),l=elementor.$previewContents.find(".elementor-element-"+e.right);return!(!t.length||!l.length||(e.leftPath=i(t),e.rightPath=i(l),0))})}),{});elementor.$previewContents.find(".elementor-widget-ts-template-tabs").each((e,t)=>{l[t.dataset.id]=i(jQuery(t))}),elementorCommon.ajax.addRequestConstant("voxel",JSON.stringify(window.voxel_prepare_page_settings()))}),elementor.modules.elements.views.BaseElement.prototype.isStyleTransferControl=function(e){return!!e&&(void 0!==e.style_transfer?e.style_transfer:"content"!==e.tab||e.selectors||e.prefix_class)};{let t=Voxel_Elementor_Config;t&&t.is_preview_card&&(document.body.classList.add("vx-editing-preview-card"),elementor.once("preview:loaded",()=>{var e=elementor.$preview.contents();e.find("body").addClass("vx-viewport-card"),e.find(".elementor.elementor-"+t.header_id).hide(),e.find(".elementor.elementor-"+t.footer_id).hide(),e.find("#query-monitor-main, .grecaptcha-badge").hide()}))}window._vx_refresh_nav_rules=function(e){var t;"object"==typeof e&&null!==e&&"function"==typeof e.getSetting&&(t=e.getSetting("_voxel_visibility_rules"),Array.isArray(t)&&t.length?jQuery("._vx-el-nav-visibility-"+e.id).removeClass("hidden"):jQuery("._vx-el-nav-visibility-"+e.id).addClass("hidden"))},window._vx_refresh_nav_loops=function(e){var t;"object"==typeof e&&null!==e&&"function"==typeof e.getSetting&&("string"==typeof(t=e.getSetting("_voxel_loop"))&&t.length?jQuery("._vx-el-nav-loops-"+e.id).removeClass("hidden"):jQuery("._vx-el-nav-loops-"+e.id).addClass("hidden"))}});
