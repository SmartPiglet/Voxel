(e=>{"function"==typeof define&&define.amd?define("planEditor",e):e()})(function(){jQuery(e=>{var n=document.getElementById("vx-edit-plan");n&&(window.$=jQuery,(n=(e=>{let n=JSON.parse(e.dataset.config);return Vue.createApp({el:e,data(){return{config:n,plan:n.plan,tab:"general",subtab:"general",loading:!1,showArchive:!1,activePrice:null,newPrice:{key:null,label:null,amount:null,discount_amount:null,currency:Voxel_Config.currency,interval:"month",frequency:1,trial:{enabled:!1,days:7}}}},created(){window.Plan_Editor=this;var e=Voxel_Backend.getSearchParam("tab");e&&(e=e.split("."),this.setTab(e[0],e[1]))},methods:{setTab(e,n=""){this.tab=e,this.subtab=n;var a=new URL(window.location);a.searchParams.set("tab",n?e+"."+n:e),window.history.replaceState(null,null,a)},save(){this.loading=!0;var e=Voxel_Config.ajax_url+"&action=membership.update_plan";jQuery.post(e,{plan:JSON.stringify(this.plan)},e=>{this.loading=!1,e.success?location.reload():alert("Error:\n - "+e.errors.join("\n - "))})},archivePlan(){var e;(this.plan.archived||confirm("This plan will no longer be available to new users. Do you want to continue?"))&&(this.loading=!0,e=Voxel_Config.ajax_url+"&action=membership.archive_plan",jQuery.post(e,{plan:this.plan},e=>{this.loading=!1,e.success?this.plan.archived=!this.plan.archived:alert("Error:\n - "+e.errors.join("\n - "))}))},deletePlan(){var e;confirm("This will permanently delete this plan. Do you want to continue?")&&(this.loading=!0,e=Voxel_Config.ajax_url+"&action=membership.delete_plan",jQuery.post(e,{plan:this.plan},e=>{this.loading=!1,e.success?location.href=e.redirect_to:alert("Error:\n - "+e.errors.join("\n - "))}))},addPrice(){var e=structuredClone(Vue.toRaw(this.newPrice));e.key=this.plan.key+"_"+Voxel_Backend.helpers.randomId(8),this.plan.prices.push(e)},deletePrice(e){confirm("Are you sure?")&&this.plan.prices.splice(e,1)},currencyFormat(e,n){return Voxel_Backend.helpers.currencyFormat(e,n)}},computed:{$w(){return window}}})})(n)).component("field-key",Voxel_Backend.components.Field_Key),n.component("draggable",vuedraggable),n.mount("#vx-edit-plan"))})});
