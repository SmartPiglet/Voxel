var orderItemDeliverables={template:`<template v-if="order.current_user.is_vendor && ( data.automatic.length || data.uploads.enabled )"><div class="order-event"><div class="order-event-icon vx-blue"><icon-files/></div><span v-if="data.automatic.length || data.manual.length">{{ data.l10n.files_shared }} </span><span v-else>{{ data.l10n.share_files }}</span><ul class="flexify simplify-ul vx-order-files"><li v-for="file in data.automatic"><a :href="file.url" class="ts-order-file">{{ file.name }}</a></li><template v-for="group, groupIndex in data.manual"><li v-for="file in group.files"><a :href="file.url" class="ts-order-file">{{ file.name }}</a> <a class="vx-remove-file" href="#" @click.prevent="removeFile(file, groupIndex)"><icon-trash/></a></li></template></ul><div v-if="data.uploads.enabled" class="further-actions"><file-upload :allowed-file-types="data.uploads.allowed_file_types.join(',')" :max-file-count="data.uploads.max_count" :sortable="false" ref="files" @update:modelValue="uploadsUpdated" v-model="new_uploads"></file-upload></div></div></template><template v-else-if="order.current_user.is_customer && ( data.automatic.length || data.manual.length )"><div class="order-event"><div class="order-event-icon vx-blue"><icon-files/></div><span>{{ data.l10n.files_available }}</span><ul class="flexify simplify-ul vx-order-files"><li v-for="file in data.automatic"><a :href="file.url" class="ts-order-file">{{ file.name }}</a></li><template v-for="group, groupIndex in data.manual"><li v-for="file in group.files"><a :href="file.url" class="ts-order-file">{{ file.name }}</a></li></template></ul></div></template>`,props:{orderItem:Object,parent:Object,order:Object,data:Object},data(){return{new_uploads:[]}},methods:{uploadsUpdated(e){this.parent.running_action=!0;let a=new FormData;e.forEach(e=>{"new_upload"===e.source&&a.append("files[deliverables][]",e.item)});e=jQuery.param({action:"products.single_order.deliverables.upload",order_id:this.order.id,order_item_id:this.orderItem.id,_wpnonce:this.$root.config.nonce});jQuery.post({url:Voxel_Config.ajax_url+"&"+e,data:a,contentType:!1,processData:!1}).always(e=>{this.parent.running_action=!1,e.success?(Voxel.alert(e.message,"success",3e3),this.parent.reload()):Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")}),this.new_uploads.length=0},removeFile(e,a){this.parent.running_action=!0;e=jQuery.param({action:"products.single_order.deliverables.delete",order_id:this.order.id,order_item_id:this.orderItem.id,file_id:e.id,group_index:a,_wpnonce:this.$root.config.nonce});jQuery.post(Voxel_Config.ajax_url+"&"+e).always(e=>{this.parent.running_action=!1,e.success?this.parent.reload():Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}}};export{orderItemDeliverables as default};
